
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>SmartPixels</title>
  <meta name="description" content="">
  <meta name="author" content="">
    <meta name="theme-color" content="#000000"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box}*+*{margin:.5em 0}pre{overflow:auto}@media(min-width:35em){.col{display:table-cell}.\31{width:5%}.\33{width:22%}.\34{width:30%}.\35{width:40%}.\32{width:15%}.\36{width:50%}.row{display:table;border-spacing:1em 0}}.row,.w-100{width:100%}.card:focus,hr{outline:0;border:solid #fa0}.card,pre{padding:1em;border:solid #eee}.btn:hover,a:hover{opacity:.6}.c{max-width:60em;padding:1em;margin:auto;font:1em/1.6 nunito}h6{font:100 1em nunito}h5{font:100 1.2em nunito}h3{font:100 2em nunito}h4{font:100 1.5em nunito}h2{font:100 2.2em nunito}h1{font:100 2.5em nunito}a{color:#fa0;text-decoration:none}.btn.primary{color:#fff;background:#fa0;border:solid #fa0}td,th{padding:1em;text-align:left;border-bottom:solid #eee}.btn{padding:1em;text-transform:uppercase;background:#fff;border:solid;font:.7em nunito}.white{color:#fff}.bg-white{background-color:#fff}.b-white{border-color:#fff}.gray{color:#ccc}.bg-gray{background-color:#ccc}.b-gray{border-color:#ccc}.black{color:#000}.bg-black{background-color:#000}.b-black{border-color:#000}.accent{color:#fa0}.bg-accent{background-color:#fa0}.b-accent{border-color:#fa0}.warning{color:#ffd600}.bg-warning{background-color:#ffd600}.b-warning{border-color:#ffd600}.error{color:#d50000}.bg-error{background-color:#d50000}.b-error{border-color:#d50000}.success{color:#00c853}.bg-success{background-color:#00c853}.b-success{border-color:#00c853}.info{color:#2962ff}.bg-info{background-color:#2962ff}.b-info{border-color:#2962ff}.m0{margin:0}.m1{margin:.5em}.m2{margin:1em}.m3{margin:2em}.m4{margin:4em}.mt0{margin-top:0}.mt1{margin-top:.5em}.mt2{margin-top:1em}.mt3{margin-top:2em}.mt4{margin-top:4em}.mr0{margin-right:0}.mr1{margin-right:.5em}.mr2{margin-right:1em}.mr3{margin-right:2em}.mr4{margin-right:4em}.mb0{margin-bottom:0}.mb1{margin-bottom:.5em}.mb2{margin-bottom:1em}.mb3{margin-bottom:2em}.mb4{margin-bottom:4em}.ml0{margin-left:0}.ml1{margin-left:.5em}.ml2{margin-left:1em}.ml3{margin-left:2em}.ml4{margin-left:4em}.p0{padding:0}.p1{padding:.5em}.p2{padding:1em}.p3{padding:2em}.p4{padding:4em}.pv0{padding-top:0;padding-bottom:0}.pv1{padding-top:.5em;padding-bottom:.5em}.pv2{padding-top:1em;padding-bottom:1em}.pv3{padding-top:2em;padding-bottom:2em}.pv4{padding-top:4em;padding-bottom:4em}.ph0{padding-right:0;padding-left:0}.ph1{padding-right:.5em;padding-left:.5em}.ph2{padding-right:1em;padding-left:1em}.ph3{padding-right:2em;padding-left:2em}.ph4{padding-right:4em;padding-left:4em}.gapless{border-spacing:0}.vc{position:relative;top:40%;transform:perspective(1px) translateY(-45%)}.pill{border-radius:9999px}.rounded{border-radius:4px}.tc{text-align:center}.mega{font-size:3.5em}.large{font-size:1.5em}.small{font-size:.7em}.caps{text-transform:uppercase}.tracked{letter-spacing:.1em}.vh-100{height:100vh}.inline{display:inline-block}.bold{font-weight:700}.normal{font-weight:400}.light{font-weight:300}.dim{opacity:1;transition:opacity .15s ease-in}.dim:focus,.dim:hover{opacity:.5;transition:opacity .15s ease-in}
</style>
  <link rel="icon" type="image/png" href="favicon.png">
</head>
<body>

  <div class="c">
  <div id="menu"></div>
  <div id="content"></div>
  <div id="status" class="bg-warning pv1 ph2 rounded"></div>
  <div id="footer"></div>

      </div>
     </div>
  </div>

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<div id="TPL"></div>

<div id="testTPL"></div>


	<script>
	
function mustache(n,t,e,r){var i,o=mustache,a="";function f(n,t){return n=null!=(n=n[(t=t.pop?t:t.split(".")).shift()])?n:"",0 in t?f(n,t):n}t=Array.isArray(t)?t:t?[t]:[],t=r?0 in t?[]:[1]:t;for(i=0;i<t.length;i++){var s,l="",p=0,g="object"==typeof t[i]?t[i]:{};(g=Object.assign({},e,g))[""]={"":t[i]},n.replace(/([\s\S]*?)({{((\/)|(\^)|#)(.*?)}}|$)/g,function(n,t,e,r,i,c,u){p?l+=p&&!i||1<p?n:t:(a+=t.replace(/{{{(.*?)}}}|{{(!?)(&?)(>?)(.*?)}}/g,function(n,t,e,r,i,c){return t?f(g,t):r?f(g,c):i?o(f(g,c),g):e?"":new Option(f(g,c)).innerHTML}),s=c),i?--p||(u=f(g,u),/^f/.test(typeof u)?a+=u.call(g,l,function(n){return o(n,g)}):a+=o(l,u,g,s),l=""):++p})}return a}var locations={last:null};(function(){var cache={};this.T=function T(eid,tid,obj){var tstr=document.getElementById(tid).innerHTML;var results=E(eid);if(obj==undefined)obj={n:true};if(results){results.innerHTML=mustache(tstr,obj)}};this.E=function E(eid){return document.getElementById(eid)};this.V=function V(eid,v){document.getElementById(eid).innerHTML=v};this.GET=function GET(url,dest,cb){var req=new XMLHttpRequest;req.onload=function(){if(this.status==200)V(dest,this.responseText);if(cb){cb(this)}};req.open("GET",url);req.responseType="text";req.send(null)};this.L=function L(o){if(o&&o.hash)locations[o.hash]=o};this.GO=function GO(hash,param){var q=null;var h=hash;var n=hash.indexOf("?");if(n!=-1){h=hash.substring(0,n);q=hash.substring(n+1)}if(h in locations){var o=locations[h];var l=locations.last;if(l&&l.leave)l.leave(l);locations.last=o;if(o&&o.enter){return o.enter(o,q,param)}}else{var nf=locations["404"];if(nf){nf.enter({hash:h},q,param)}}return null}})();var localstore={s:window.localStorage,type:"localStorage",set:function(key,val){this.s.setItem(key,JSON.stringify(val));return val},get:function(key){var value=this.s.getItem(key);if(typeof value!="string"){return undefined}try{return JSON.parse(value)}catch(e){return value||undefined}},remove:function(key){this.s.removeItem(key)},removeAll:function(){this.s.clear()},getAll:function(){var ret={};for(var i=0;i<this.s.length;i++){var key=this.s.key(i);ret[key]=this.get(key)}return ret}};var p_home={hash:"#/",enter:function(){if(s_devinfo)T("content","t_devinfo",s_devinfo)},leave:function(){}};var p_status={hash:"#/status",enter:function(){var devinfo={};if(s_devinfo)devinfo=s_devinfo;T("content","t_status",devinfo)}};var p_play={hash:"#/play",enter:function(){T("content","t_play")}};var p_404={hash:"404",enter:function(v,q,req){T("content","t_404",{hash:v.hash,q:q})}};var p_setting={hash:"#/setting",enter:function(){if(s_devinfo)T("content","t_setting",s_devinfo);else{V("content","");showNotify("Not connected")}},leave:function(){}};function playEffect(type,id){sendReq(M_PLAY_EFFECT,{type:type,id:id})}function removeEffect(type,id){sendReq(M_REMOVE_EFFECT,{type:type,id:id},function(e){showNotify("Effect removed!");sendReq(M_GET_EFFECT_LIST,null,function(data){T("content","t_effect",data)})})}function getEffectDetail(id){sendReq(M_GET_EFFECT_DETAIL,id,function(e){if(e.rc==1){var dt=new Date;dt.setTime(e.p.dt*1e3);e.p.timestr=dt.toUTCString();playEffect(3,id);T("eff-detail","t_effect_detail",e.p)}})}var p_effect={hash:"#/effect",enter:function(){sendReq(M_GET_EFFECT_LIST,null,function(data){T("content","t_effect",data)})},leave:function(){}};var p_upgrade={hash:"#/upgrade",enter:function(){T("content","t_upgrade");upgradeInit()},leave:function(){}};function saveSignal(){var v=parseInt(E("pwmval").value);sendReq(M_SAVE_OUTPUT_PWM,v,function(e){if(e.rc==0){showNotify("SignalValue saved-"+e.p);V("curpwm",e.p)}})}function testSignal(){var v=parseInt(E("pwmval").value);sendReq(M_SET_OUTPUT_PWM,v,function(e){if(e.rc==0){V("curpwm",e.p)}})}function resetSignal(){sendReq(M_SET_OUTPUT_PWM,285)}var p_signal={hash:"#/signal",enter:function(){T("content","t_signal");regNotify(M_GET_OUTPUT_PWM,null,function(e){if(e.rc==0){V("curpwm",e.p);E("pwmval").value=e.p}});sendReq(M_GET_OUTPUT_PWM)},leave:function(){}};function clearWifiParam(){sendReq(M_CLEAR_WIFI_PARAM)}function setWifiname(name){E("wifiname").value=name}function setWifiParam(){var m={n:E("wifiname").value,s:E("wifisec").value};sendReq(M_SET_WIFI_PARAM,m,function(e){})}var p_network={hash:"#/network",enter:function(){T("content","t_network");sendReq(M_SCAN_APLIST,null,function(data){if(data.rc==0){T("current","t_wifi_current",data.p);T("scanlist","t_wifi_scanlist",data.p)}})}};function layout_h_flip(){sendReq(M_SET_LAYOUT_DIR,4)}function layout_v_flip(){sendReq(M_SET_LAYOUT_DIR,5)}function layout_reset(){sendReq(M_SET_LAYOUT_DIR,0)}function layout_apply(){sendReq(M_SET_LAYOUT_DIR,9)}var p_layout={hash:"#/layout",enter:function(){T("content","t_layout");sendReq(M_GET_LAYOUT,null,function(e){})}};var p_security={hash:"#/security",enter:function(){T("content","t_security")}};var p_lang={hash:"#/lang",enter:function(){T("content","t_lang")}};function set_speed(){var v=parseInt(E("fps").value);sendReq(M_SET_PLAY_SPEED,v)}function save_speed(){var v=parseInt(E("fps").value);sendReq(M_SAVE_PLAY_SPEED,v,function(e){showNotify("PlaySpeed saved")})}function reset_speed(){sendReq(M_RESET_PLAY_SPEED,null,function(e){E("fps").value=""+e.p;showNotify("PlaySpeed Reset")})}var p_framerate={hash:"#/framerate",enter:function(){T("content","t_framerate");sendReq(M_GET_PLAY_SPEED,null,function(e){E("fps").value=""+e.p})}};function onTimeChange(){var v=parseInt(E("on_time").value);V("c_on_time",""+v+"  Hours on,  "+(24-v)+" Hours off")}function disableTimer(){sendReq(M_DISABLE_AUTO_TIMER,null,function(e){showNotify("timer disabled")})}function saveTimer(){var v=parseInt(E("on_time").value);sendReq(M_SET_AUTO_TIMER,v,function(e){showNotify("Timer saved")})}var p_timer={hash:"#/timer",enter:function(){T("content","t_timer");sendReq(M_GET_AUTO_TIMER,null,function(e){E("on_time").value=""+e.p;onTimeChange()})}};function disableE131(){sendReq(M_DISABLE_E131,null,function(e){showNotify("E131 disabled")})}function saveE131(){var param=E("ch1").value+";"+E("ch2").value+";"+E("ch3").value;var info={un:parseInt(E("un").value),param:param};sendReq(M_SET_E131_PARAM,info,function(e){showNotify("E131 Param saved")})}var p_e131={hash:"#/e131",enter:function(){T("content","t_e131");sendReq(M_GET_E131_PARAM,null,function(e){var p=e.p.param.split(";");E("un").value=e.p.un;E("ch1").value=p[0];E("ch2").value=p[1];E("ch3").value=p[2]})}};var p_login={hash:"#/login",enter:function(){T("content","t_login")}};var p_test={hash:"#/test",enter:function(){loadTestTPL(function(e){testInit()})},leave:function(){sendReq(M_LEAVE_TEST_MODE);autoTestStop()}};function setHashs(){L(p_home);L(p_status);L(p_play);L(p_setting);L(p_signal);L(p_effect);L(p_upgrade);L(p_network);L(p_layout);L(p_security);L(p_framerate);L(p_timer);L(p_e131);L(p_login);L(p_test);L(p_lang);L(p_404)}function showNotify(msg,last){V("status",'<span class="toast">'+msg+"</span>");if(undefined==last){setTimeout(function(){V("status","")},5e3)}}var s_devinfo;var savedPassword;function updateDeviceInfo(info){s_devinfo=info;console.log(location.hash);if(!savedPassword){var s=localstore.get("pin");if(s){savedPassword=s;console.log("Load saved password from localstore")}}if(savedPassword&&info.security&&!info.login){sendReq(M_DEV_AUTH_LOGIN,{pin:savedPassword},function(e){if(e.rc!=0){savedPassword=null;localstore.remove("pin");showNotify("Login failed",1);document.location="#/login"}else{showNotify("Login ok")}})}else if(info.security&&!info.login){GO("#/");showNotify("Login Required")}else{if(!location.hash||location.hash=="#/")T("content","t_devinfo",s_devinfo);else if(location.hash=="#/status")p_status.enter()}}var savedPassword;function doLogin(){var r={pin:E("password").value};sendReq(M_DEV_AUTH_LOGIN,r,function(e){if(e.rc==0){showNotify("login successfully");savedPassword=r.pin;localstore.set("pin",r.pin);GO("#/play")}else{showNotify("login failed, please try again");savedPassword=null;localstore.remove("pin")}})}function updateSecurity(){var r={name:E("devname").value,pin:E("password").value};sendReq(M_SET_AUTHTOK,r,function(e){if(e.rc==0){showNotify("Security information updated!")}})}function reboot(){sendReq(M_REBOOT);GO("#/")}var wsUri="ws://192.168.0.196:8080/ws";var ws;var tid;function wsinit(){if(ws)return;ws=new WebSocket(wsUri);ws.onopen=function(evt){onOpen(evt)};ws.onclose=function(evt){onClose(evt)};ws.onmessage=function(evt){onMessage(evt)};ws.onerror=function(evt){onError(evt)};if(tid)clearInterval(tid);showNotify("Connecting ...")}function onOpen(evt){showNotify("Connected!")}function onClose(evt){showNotify("Disconnected!",1);ws=null;setTimeout(wsinit,3e3);if(tid){clearInterval(tid)}}setInterval(function(){tid=null;if(ws==null){wsinit()}},1e4);function onMessage(evt){var res=JSON.parse(evt.data);if(res&&res.m){onResponse(res)}}function onError(evt){}var idle_cnt=0;function doSend(message){if(ws){if(message instanceof Object)ws.send(JSON.stringify(message));idle_cnt=0}}function idleSend(){if(ws){idle_cnt++;if(idle_cnt>5){doSend({m:M_DEVICE_IDLE});idle_cnt=0}}}function doClose(){if(ws){ws.close();ws=null}}var waitingList=[];var sn=1;function sendReq(id,data,cb){doSend({m:id,p:data,cn:sn});if(cb){waitingList.push({cn:sn,m:id,cb:cb})}sn++}function regNotify(mid,sn,cb){if(cb){waitingList.push({cn:sn,m:mid,cb:cb})}}function removeNotify(mid,sn,cb){for(var i=0;i<waitingList.length;i++){var p=waitingList[i];if(mid&&p.m!=mid)continue;if(cb&&p.cb!=cb)continue;if(sn&&p.cn!=sn)continue;waitingList.slice(i,1);break}}function getNextSn(){var o=sn;sn++;return o}function onResponse(res){if(res.m==M_DEVICE_IDLE)return;if(res.rc==-999){showNotify("Login required",1);document.location="#/login"}if(res.m==M_DEVICE_INFO_NOTIFY){updateDeviceInfo(res.p)}for(var i=0;i<waitingList.length;i++){var p=waitingList[i];if(!p.cn&&res.m==p.m||p.cn&&res.m==p.m&&res.on==p.cn){p.cb(res);if(p.cn&&res.on)waitingList.slice(i,1);break}}}function sendRes(id,data,osn,rc){doSend({m:id,p:data,cn:sn,on:osn,rc:rc})}function sendNotify(id,data){doSend({m:id,p:data})}function setColor(r,g,b,mode){if(typeof r=="string"){var c=r;r=parseInt(c.substring(1,3),16);g=parseInt(c.substring(3,5),16);b=parseInt(c.substring(5),16)}if(mode==undefined)mode=1;sendReq(M_SET_COLOR,{r:r,g:g,b:b,m:mode})}var M_DEV_AUTH_LOGIN=101;var M_SET_AUTHTOK=102;var M_SET_CLOUDLINK=103;var M_SCAN_APLIST=201;var M_SET_WIFI_PARAM=202;var M_GET_WIFI_PARAM=203;var M_CLEAR_WIFI_PARAM=204;var M_GET_NET_DETAIL=205;var M_DEVICE_INFO_NOTIFY=301;var M_GET_LAYOUT=302;var M_SET_LAYOUT_DIR=303;var M_SET_DEVICE_NAME=304;var M_DEVICE_IDLE=305;var M_SET_COLOR=401;var M_PLAY_NEXT=402;var M_PLAY_PREV=403;var M_PLAY_EFFECT=404;var M_SET_MODE_LOOP=405;var M_SET_MODE_SINGLE=406;var M_SET_BRIGHTNESS=407;var M_SET_POWERON=408;var M_SET_POWEROFF=409;var M_START_TRANSFER_FRAME=410;var M_END_TRANSFER_FRAME=411;var M_LOCK_FRAME=412;var M_UNLOCK_FRAME=413;var M_SET_E131_PARAM=414;var M_GET_E131_PARAM=415;var M_DISABLE_E131=417;var M_PLAY_INFO_NOTIFY=501;var M_ADD_PLAYLIST=502;var M_REMOVE_PLAYLIST=503;var M_GET_PLAYLIST=504;var M_START_INSTALL_EFFECT=505;var M_END_INSTALL_EFFECT=506;var M_REMOVE_EFFECT=507;var M_GET_EFFECT_LIST=508;var M_GET_EFFECT_DETAIL=509;var M_SEARCH_EFFECT=510;var M_BOOKMARK_EFFECT=511;var M_BOOKMARK_REMOVE=512;var M_BOOKMARK_LIST=513;var M_ENABLE_BOOKMARK_PLAY=514;var M_DISABLE_BOOKMARK_PLAY=515;var M_ADD_TIMER=601;var M_REMOVE_TIMER=602;var M_GET_TIMER_LIST=603;var M_ENABLE_TIMER=604;var M_DISABLE_TIMER=605;var M_SYNC_TIME_INFO=606;var M_SET_AUTO_TIMER=607;var M_ENABLE_AUTO_TIMER=608;var M_DISABLE_AUTO_TIMER=609;var M_GET_AUTO_TIMER=610;var M_START_UPDATE_FIRMWARE=701;var M_END_UPDATE_FIRMWARE=702;var M_START_INSTALL_EFFECTS=703;var M_END_INSTALL_EFFECTS=704;var M_START_UPDATE_LAYOUT=705;var M_END_UPDATE_LAYOUT=706;var M_SET_OUTPUT_PWM=708;var M_GET_OUTPUT_PWM=709;var M_INC_OUTPUT_PWM=710;var M_DEC_OUTPUT_PWM=711;var M_SAVE_OUTPUT_PWM=712;var M_SET_PLAY_SPEED=713;var M_RESET_PLAY_SPEED=714;var M_SAVE_PLAY_SPEED=715;var M_GET_PLAY_SPEED=716;var M_REBOOT=799;var M_ENTER_TEST_MODE=901;var M_LEAVE_TEST_MODE=902;var M_TEST_ROWS_COLOR=903;var M_TEST_COLS_COLOR=904;var M_TEST_PIXELS_COLOR=905;var M_TEST_CLEAR_COLOR=906;var s_efile=null;function installInit(){input=E("filename");input.onchange=function(){var file=this.files[0];if(!!file){s_efile=file}}}function installStart(slot){if(!s_efile){console.log("File not selected");return}var reader=new FileReader;reader.onload=function(){var binary=this.result;var hash=md5(binary);console.log("File size is ",binary.byteLength,",  Hash is ",hash);upgradeSend(M_START_INSTALL_EFFECT,M_END_INSTALL_EFFECT,binary,hash,slot,function(e){console.log(e);if(e.rc==0){showNotify("Install effect completed");setTimeout(function(){playEffect(3,slot);GO("#/effect")},3e3)}else{showNotify("Install effect failed, rc="+e.rc)}})};reader.readAsArrayBuffer(s_efile)}function installAt(slot){GO("#/install/at/"+slot);T("content","t_install_effect",{slot:slot});installInit()}var s_file=null;function upgradeInit(){input=E("filename");input.onchange=function(){var file=this.files[0];if(!!file){s_file=file}}}function upgradeStart(){if(!s_file)return;var reader=new FileReader;reader.readAsArrayBuffer(s_file);reader.onload=function(){var binary=this.result;var hash=md5(binary);console.log("File size is ",binary.byteLength,",  Hash is ",hash);var filetype=E("filetype").value;switch(filetype){case"1":upgradeSend(M_START_UPDATE_FIRMWARE,M_END_UPDATE_FIRMWARE,binary,hash);break;case"2":upgradeSend(M_START_INSTALL_EFFECTS,M_END_INSTALL_EFFECTS,binary,hash);break;case"3":upgradeSend(M_START_INSTALL_EFFECT,M_END_INSTALL_EFFECT,binary,hash);break;case"4":upgradeSend(M_START_UPDATE_LAYOUT,M_END_UPDATE_LAYOUT,binary,hash);break;default:alert("Not supported");break}}}var buflist=[];var bufsize=0;var progress=0;function sendFile(){if(ws&&ws.bufferedAmount==0){var buf=buflist.shift();if(!buf)return;if(ws)ws.send(buf);progress++;V("progress",""+progress+" of "+bufsize)}if(buflist.length>0){setTimeout(sendFile,1e3);console.log("MSG in queue is ",buflist.length)}else console.log("MSG sent end")}function upgradeSend(startmid,endmid,binary,hash,slot,cb){var start={m:startmid,p:{csum:hash,size:binary.byteLength,slot:slot},cn:getNextSn()};var end={m:endmid,cn:getNextSn()};regNotify(end.m,end.cn,function(e){if(cb)cb(e);else showNotify("更新已经完成")});progress=0;buflist=[];buflist.push(JSON.stringify(start));var n=parseInt(binary.byteLength/40960);var r=parseInt(binary.byteLength%40960);for(var i=0;i<n;i++){buflist.push(binary.slice(i*40960,(i+1)*40960))}if(r>0){buflist.push(binary.slice(n*40960))}buflist.push(JSON.stringify(end));bufsize=buflist.length;sendFile()}var tc={w:0,h:0,n:0,rowMax:0,colMax:0,startRow:0,endRow:0,startCol:0,endCol:0,c0:"#ff0000",c1:"#00ff00",c2:"#0000ff",c3:"#ffffff",c4:"#ff00ff",pcs:["#ff0000","#00ff00","#0000ff","#ffffff"],startId:0,idMax:0,endId:0,cs:[]};function ccb(name){console.log("Changed-",name,"=",E(name).value);if(name=="c0"||name=="c1"||name=="c2"||name=="c3"||name=="c4"){tc[name]=E(name).value;V("c_"+name,E(name).value)}else{tc[name]=parseInt(E(name).value);V("c_"+name,E(name).value);E("i_"+name).value=E(name).value}}function iccb(name){E(name).value=E("i_"+name).value;V("c_"+name,E("i_"+name).value);tc[name]=parseInt(E("i_"+name).value)}function add_color(name){var v=E(name).value;var str="<button style='background:"+v+"'>&nbsp;&nbsp;</button>";E("colors").innerHTML+=str;getColor(tc.cs,name)}function clear_color(){tc.cs=[];E("colors").innerHTML=""}function testInit(){sendReq(M_ENTER_TEST_MODE,null,function(e){tc.w=e.p.w;tc.h=e.p.h;tc.n=e.p.n;tc.idMax=e.p.n-1;tc.rowMax=tc.h-1;tc.colMax=tc.w-1;tc.endRow=tc.rowMax;tc.endCol=tc.colMax;tc.endId=tc.idMax;T("content","t_test",tc);getColorVec(tc.cs,tc.pcs);var str="";for(var i=0;i<tc.pcs.length;i++){str+="<button style='background:"+tc.pcs[i]+"'>&nbsp;&nbsp;</button>"}E("colors").innerHTML+=str})}function srow_inc(){tc.startRow++;if(tc.startRow>=tc.h)tc.startRow=tc.h-1;E("i_startRow").value=tc.startRow;E("startRow").value=tc.startRow;V("c_startRow",tc.startRow)}function srow_dec(){tc.startRow--;if(tc.startRow<0)tc.startRow=0;E("i_startRow").value=tc.startRow;E("startRow").value=tc.startRow;V("c_startRow",tc.startRow)}function erow_inc(){tc.endRow++;if(tc.endRow>=tc.h)tc.endRow=tc.h-1;E("i_endRow").value=tc.endRow;E("endRow").value=tc.endRow;V("c_endRow",tc.endRow)}function erow_dec(){tc.endRow--;if(tc.endRow<0)tc.endRow=0;E("i_endRow").value=tc.endRow;E("endRow").value=tc.endRow;V("c_endRow",tc.endRow)}function scol_inc(){tc.startCol++;if(tc.startCol>=tc.w)tc.startCol=tc.w-1;E("i_startCol").value=tc.startCol;E("startCol").value=tc.startCol;V("c_startCol",tc.startCol)}function scol_dec(){tc.startCol--;if(tc.startCol<0)tc.startCol=0;E("i_startCol").value=tc.startCol;E("startCol").value=tc.startCol;V("c_startCol",tc.startCol)}function ecol_inc(){tc.endCol++;if(tc.endCol>=tc.w)tc.endCol=tc.w-1;E("i_endCol").value=tc.endCol;E("endCol").value=tc.endCol;V("c_endCol",tc.endCol)}function ecol_dec(){tc.endCol--;if(tc.endCol<0)tc.endCol=0;E("i_endCol").value=tc.endCol;E("endCol").value=tc.endCol;V("c_endCol",tc.endCol)}function sid_inc(){tc.startId++;if(tc.startId>=tc.idMax)tc.startId=tc.idMax-1;E("i_startId").value=tc.startId;E("startId").value=tc.startId;V("c_startId",tc.startId)}function sid_dec(){tc.startId--;if(tc.startId<0)tc.startId=0;E("i_startId").value=tc.startId;E("startId").value=tc.startId;V("c_startId",tc.startId)}function eid_inc(){tc.endId++;if(tc.endId>=tc.idMax)tc.endId=tc.idMax-1;E("i_endId").value=tc.endId;E("endId").value=tc.endId;V("c_endId",tc.endId)}function eid_dec(){tc.endId--;if(tc.endId<0)tc.endId=0;E("i_endId").value=tc.endId;E("endId").value=tc.endId;V("c_endId",tc.endId)}function getColor(o,id){v=tc[id];var c={};c.r=parseInt(v.substring(1,3),16);c.g=parseInt(v.substring(3,5),16);c.b=parseInt(v.substring(5),16);o.push(c)}function getColorVec(o,vcs){for(var i=0;i<vcs.length;i++){v=vcs[i];var c={};c.r=parseInt(v.substring(1,3),16);c.g=parseInt(v.substring(3,5),16);c.b=parseInt(v.substring(5),16);o.push(c)}}function rowTest(){console.log("#rowTest#");var m={cs:tc.cs,rows:[],clr:1};if(!E("clr").checked)m.clr=0;for(var i=tc.startRow;i<=tc.endRow;i++)m.rows.push(i);if(m.cs.length==0)getColor(m.cs,"c0");sendReq(M_TEST_ROWS_COLOR,m);showNotify("行测试已完成!")}function colTest(){console.log("#colTest#");var m={cs:tc.cs,cols:[],clr:1};if(!E("clr").checked)m.clr=0;for(var i=tc.startCol;i<=tc.endCol;i++)m.cols.push(i);if(m.cs.length==0)getColor(m.cs,"c0");sendReq(M_TEST_COLS_COLOR,m);showNotify("列测试已完成!")}function idsTest(){console.log("#pixelsTest#");var m={cs:tc.cs,sa:tc.startId,ea:tc.endId,clr:1};if(!E("clr").checked)m.clr=0;if(m.cs.length==0)getColor(m.cs,"c0");sendReq(M_TEST_PIXELS_COLOR,m)}function clearTest(){console.log("#clearTest");var m={cs:[]};getColor(m.cs,"c4");sendReq(M_TEST_CLEAR_COLOR,m)}var testlist=[];var testidx=0;var runtest=false;var runinterval=200;function intervalChanged(){var t=parseInt(E("runinterval").value);if(t>50&&t<5e3)runinterval=t;else runinterval=200;V("c_runinterval",runinterval)}function execAutoTest(){if(!runtest||testlist.length==0){showNotify("自动测试已经停止");return}if(testidx>=testlist.length){testidx=0}var item=testlist[testidx];sendReq(item.m,item.d);testidx++;setTimeout(execAutoTest,runinterval)}function autoTestStop(){testlist=[];testidx=0}function autoPixelStart(){autoTestStop();setTimeout(function(){testlist=[];var idx=0;testlist.push({m:M_TEST_CLEAR_COLOR,d:{cs:[{r:0,g:0,b:0}]}});for(var i=tc.startId;i<=tc.endId;i++){var n=idx%tc.cs.length;idx++;testlist.push({m:M_TEST_PIXELS_COLOR,d:{cs:[tc.cs[n]],sa:i,ea:i,clr:0}})}testidx=0;setTimeout(execAutoTest,runinterval);runtest=true;showNotify("正在进行自动测试中...",1)},1500)}function autoRowStart(){autoTestStop();setTimeout(function(){testlist=[];var idx=0;testlist.push({m:M_TEST_CLEAR_COLOR,d:{cs:[{r:0,g:0,b:0}]}});for(var i=tc.startRow;i<=tc.endRow;i++){var n=idx%tc.cs.length;idx++;testlist.push({m:M_TEST_ROWS_COLOR,d:{cs:[tc.cs[n]],rows:[i],clr:0}})}testidx=0;setTimeout(execAutoTest,runinterval);runtest=true;showNotify("正在进行自动测试中...",1)},1500)}function autoColStart(){autoTestStop();setTimeout(function(){testlist=[];var idx=0;testlist.push({m:M_TEST_CLEAR_COLOR,d:{cs:[{r:0,g:0,b:0}]}});for(var i=tc.startCol;i<=tc.endCol;i++){var n=idx%tc.cs.length;idx++;testlist.push({m:M_TEST_COLS_COLOR,d:{cs:[tc.cs[n]],cols:[i],clr:0}})}testidx=0;setTimeout(execAutoTest,runinterval);runtest=true;showNotify("正在进行自动测试中...",1)},1500)}!function(){"use strict";function t(t){if(t)d[0]=d[16]=d[1]=d[2]=d[3]=d[4]=d[5]=d[6]=d[7]=d[8]=d[9]=d[10]=d[11]=d[12]=d[13]=d[14]=d[15]=0,this.blocks=d,this.buffer8=l;else if(a){var r=new ArrayBuffer(68);this.buffer8=new Uint8Array(r),this.blocks=new Uint32Array(r)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}var r="input is invalid type",e="object"==typeof window,i=e?window:{};i.JS_MD5_NO_WINDOW&&(e=!1);var s=!e&&"object"==typeof self,h=!i.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;h?i=global:s&&(i=self);var f=!i.JS_MD5_NO_COMMON_JS&&"object"==typeof module&&module.exports,o="function"==typeof define&&define.amd,a=!i.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,n="0123456789abcdef".split(""),u=[128,32768,8388608,-2147483648],y=[0,8,16,24],c=["hex","array","digest","buffer","arrayBuffer","base64"],p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),d=[],l;if(a){var A=new ArrayBuffer(68);l=new Uint8Array(A),d=new Uint32Array(A)}!i.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),!a||!i.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(t){return"object"==typeof t&&t.buffer&&t.buffer.constructor===ArrayBuffer});var b=function(r){return function(e){return new t(!0).update(e)[r]()}},v=function(){var r=b("hex");h&&(r=w(r)),r.create=function(){return new t},r.update=function(t){return r.create().update(t)};for(var e=0;e<c.length;++e){var i=c[e];r[i]=b(i)}return r},w=function(t){var e=eval("require('crypto')"),i=eval("require('buffer').Buffer"),s=function(s){if("string"==typeof s)return e.createHash("md5").update(s,"utf8").digest("hex");if(null===s||void 0===s)throw r;return s.constructor===ArrayBuffer&&(s=new Uint8Array(s)),Array.isArray(s)||ArrayBuffer.isView(s)||s.constructor===i?e.createHash("md5").update(new i(s)).digest("hex"):t(s)};return s};t.prototype.update=function(t){if(!this.finalized){var e,i=typeof t;if("string"!==i){if("object"!==i)throw r;if(null===t)throw r;if(a&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!(Array.isArray(t)||a&&ArrayBuffer.isView(t)))throw r;e=!0}for(var s,h,f=0,o=t.length,n=this.blocks,u=this.buffer8;f<o;){if(this.hashed&&(this.hashed=!1,n[0]=n[16],n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),e)if(a)for(h=this.start;f<o&&h<64;++f)u[h++]=t[f];else for(h=this.start;f<o&&h<64;++f)n[h>>2]|=t[f]<<y[3&h++];else if(a)for(h=this.start;f<o&&h<64;++f)(s=t.charCodeAt(f))<128?u[h++]=s:s<2048?(u[h++]=192|s>>6,u[h++]=128|63&s):s<55296||s>=57344?(u[h++]=224|s>>12,u[h++]=128|s>>6&63,u[h++]=128|63&s):(s=65536+((1023&s)<<10|1023&t.charCodeAt(++f)),u[h++]=240|s>>18,u[h++]=128|s>>12&63,u[h++]=128|s>>6&63,u[h++]=128|63&s);else for(h=this.start;f<o&&h<64;++f)(s=t.charCodeAt(f))<128?n[h>>2]|=s<<y[3&h++]:s<2048?(n[h>>2]|=(192|s>>6)<<y[3&h++],n[h>>2]|=(128|63&s)<<y[3&h++]):s<55296||s>=57344?(n[h>>2]|=(224|s>>12)<<y[3&h++],n[h>>2]|=(128|s>>6&63)<<y[3&h++],n[h>>2]|=(128|63&s)<<y[3&h++]):(s=65536+((1023&s)<<10|1023&t.charCodeAt(++f)),n[h>>2]|=(240|s>>18)<<y[3&h++],n[h>>2]|=(128|s>>12&63)<<y[3&h++],n[h>>2]|=(128|s>>6&63)<<y[3&h++],n[h>>2]|=(128|63&s)<<y[3&h++]);this.lastByteIndex=h,this.bytes+=h-this.start,h>=64?(this.start=h-64,this.hash(),this.hashed=!0):this.start=h}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},t.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,r=this.lastByteIndex;t[r>>2]|=u[3&r],r>=56&&(this.hashed||this.hash(),t[0]=t[16],t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.bytes<<3,t[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},t.prototype.hash=function(){var t,r,e,i,s,h,f=this.blocks;this.first?r=((r=((t=((t=f[0]-680876937)<<7|t>>>25)-271733879<<0)^(e=((e=(-271733879^(i=((i=(-1732584194^2004318071&t)+f[1]-117830708)<<12|i>>>20)+t<<0)&(-271733879^t))+f[2]-1126478375)<<17|e>>>15)+i<<0)&(i^t))+f[3]-1316259209)<<22|r>>>10)+e<<0:(t=this.h0,r=this.h1,e=this.h2,r=((r+=((t=((t+=((i=this.h3)^r&(e^i))+f[0]-680876936)<<7|t>>>25)+r<<0)^(e=((e+=(r^(i=((i+=(e^t&(r^e))+f[1]-389564586)<<12|i>>>20)+t<<0)&(t^r))+f[2]+606105819)<<17|e>>>15)+i<<0)&(i^t))+f[3]-1044525330)<<22|r>>>10)+e<<0),r=((r+=((t=((t+=(i^r&(e^i))+f[4]-176418897)<<7|t>>>25)+r<<0)^(e=((e+=(r^(i=((i+=(e^t&(r^e))+f[5]+1200080426)<<12|i>>>20)+t<<0)&(t^r))+f[6]-1473231341)<<17|e>>>15)+i<<0)&(i^t))+f[7]-45705983)<<22|r>>>10)+e<<0,r=((r+=((t=((t+=(i^r&(e^i))+f[8]+1770035416)<<7|t>>>25)+r<<0)^(e=((e+=(r^(i=((i+=(e^t&(r^e))+f[9]-1958414417)<<12|i>>>20)+t<<0)&(t^r))+f[10]-42063)<<17|e>>>15)+i<<0)&(i^t))+f[11]-1990404162)<<22|r>>>10)+e<<0,r=((r+=((t=((t+=(i^r&(e^i))+f[12]+1804603682)<<7|t>>>25)+r<<0)^(e=((e+=(r^(i=((i+=(e^t&(r^e))+f[13]-40341101)<<12|i>>>20)+t<<0)&(t^r))+f[14]-1502002290)<<17|e>>>15)+i<<0)&(i^t))+f[15]+1236535329)<<22|r>>>10)+e<<0,r=((r+=((i=((i+=(r^e&((t=((t+=(e^i&(r^e))+f[1]-165796510)<<5|t>>>27)+r<<0)^r))+f[6]-1069501632)<<9|i>>>23)+t<<0)^t&((e=((e+=(t^r&(i^t))+f[11]+643717713)<<14|e>>>18)+i<<0)^i))+f[0]-373897302)<<20|r>>>12)+e<<0,r=((r+=((i=((i+=(r^e&((t=((t+=(e^i&(r^e))+f[5]-701558691)<<5|t>>>27)+r<<0)^r))+f[10]+38016083)<<9|i>>>23)+t<<0)^t&((e=((e+=(t^r&(i^t))+f[15]-660478335)<<14|e>>>18)+i<<0)^i))+f[4]-405537848)<<20|r>>>12)+e<<0,r=((r+=((i=((i+=(r^e&((t=((t+=(e^i&(r^e))+f[9]+568446438)<<5|t>>>27)+r<<0)^r))+f[14]-1019803690)<<9|i>>>23)+t<<0)^t&((e=((e+=(t^r&(i^t))+f[3]-187363961)<<14|e>>>18)+i<<0)^i))+f[8]+1163531501)<<20|r>>>12)+e<<0,r=((r+=((i=((i+=(r^e&((t=((t+=(e^i&(r^e))+f[13]-1444681467)<<5|t>>>27)+r<<0)^r))+f[2]-51403784)<<9|i>>>23)+t<<0)^t&((e=((e+=(t^r&(i^t))+f[7]+1735328473)<<14|e>>>18)+i<<0)^i))+f[12]-1926607734)<<20|r>>>12)+e<<0,r=((r+=((h=(i=((i+=((s=r^e)^(t=((t+=(s^i)+f[5]-378558)<<4|t>>>28)+r<<0))+f[8]-2022574463)<<11|i>>>21)+t<<0)^t)^(e=((e+=(h^r)+f[11]+1839030562)<<16|e>>>16)+i<<0))+f[14]-35309556)<<23|r>>>9)+e<<0,r=((r+=((h=(i=((i+=((s=r^e)^(t=((t+=(s^i)+f[1]-1530992060)<<4|t>>>28)+r<<0))+f[4]+1272893353)<<11|i>>>21)+t<<0)^t)^(e=((e+=(h^r)+f[7]-155497632)<<16|e>>>16)+i<<0))+f[10]-1094730640)<<23|r>>>9)+e<<0,r=((r+=((h=(i=((i+=((s=r^e)^(t=((t+=(s^i)+f[13]+681279174)<<4|t>>>28)+r<<0))+f[0]-358537222)<<11|i>>>21)+t<<0)^t)^(e=((e+=(h^r)+f[3]-722521979)<<16|e>>>16)+i<<0))+f[6]+76029189)<<23|r>>>9)+e<<0,r=((r+=((h=(i=((i+=((s=r^e)^(t=((t+=(s^i)+f[9]-640364487)<<4|t>>>28)+r<<0))+f[12]-421815835)<<11|i>>>21)+t<<0)^t)^(e=((e+=(h^r)+f[15]+530742520)<<16|e>>>16)+i<<0))+f[2]-995338651)<<23|r>>>9)+e<<0,r=((r+=((i=((i+=(r^((t=((t+=(e^(r|~i))+f[0]-198630844)<<6|t>>>26)+r<<0)|~e))+f[7]+1126891415)<<10|i>>>22)+t<<0)^((e=((e+=(t^(i|~r))+f[14]-1416354905)<<15|e>>>17)+i<<0)|~t))+f[5]-57434055)<<21|r>>>11)+e<<0,r=((r+=((i=((i+=(r^((t=((t+=(e^(r|~i))+f[12]+1700485571)<<6|t>>>26)+r<<0)|~e))+f[3]-1894986606)<<10|i>>>22)+t<<0)^((e=((e+=(t^(i|~r))+f[10]-1051523)<<15|e>>>17)+i<<0)|~t))+f[1]-2054922799)<<21|r>>>11)+e<<0,r=((r+=((i=((i+=(r^((t=((t+=(e^(r|~i))+f[8]+1873313359)<<6|t>>>26)+r<<0)|~e))+f[15]-30611744)<<10|i>>>22)+t<<0)^((e=((e+=(t^(i|~r))+f[6]-1560198380)<<15|e>>>17)+i<<0)|~t))+f[13]+1309151649)<<21|r>>>11)+e<<0,r=((r+=((i=((i+=(r^((t=((t+=(e^(r|~i))+f[4]-145523070)<<6|t>>>26)+r<<0)|~e))+f[11]-1120210379)<<10|i>>>22)+t<<0)^((e=((e+=(t^(i|~r))+f[2]+718787259)<<15|e>>>17)+i<<0)|~t))+f[9]-343485551)<<21|r>>>11)+e<<0,this.first?(this.h0=t+1732584193<<0,this.h1=r-271733879<<0,this.h2=e-1732584194<<0,this.h3=i+271733878<<0,this.first=!1):(this.h0=this.h0+t<<0,this.h1=this.h1+r<<0,this.h2=this.h2+e<<0,this.h3=this.h3+i<<0)},t.prototype.hex=function(){this.finalize();var t=this.h0,r=this.h1,e=this.h2,i=this.h3;return n[t>>4&15]+n[15&t]+n[t>>12&15]+n[t>>8&15]+n[t>>20&15]+n[t>>16&15]+n[t>>28&15]+n[t>>24&15]+n[r>>4&15]+n[15&r]+n[r>>12&15]+n[r>>8&15]+n[r>>20&15]+n[r>>16&15]+n[r>>28&15]+n[r>>24&15]+n[e>>4&15]+n[15&e]+n[e>>12&15]+n[e>>8&15]+n[e>>20&15]+n[e>>16&15]+n[e>>28&15]+n[e>>24&15]+n[i>>4&15]+n[15&i]+n[i>>12&15]+n[i>>8&15]+n[i>>20&15]+n[i>>16&15]+n[i>>28&15]+n[i>>24&15]},t.prototype.toString=t.prototype.hex,t.prototype.digest=function(){this.finalize();var t=this.h0,r=this.h1,e=this.h2,i=this.h3;return[255&t,t>>8&255,t>>16&255,t>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255,255&e,e>>8&255,e>>16&255,e>>24&255,255&i,i>>8&255,i>>16&255,i>>24&255]},t.prototype.array=t.prototype.digest,t.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(16),r=new Uint32Array(t);return r[0]=this.h0,r[1]=this.h1,r[2]=this.h2,r[3]=this.h3,t},t.prototype.buffer=t.prototype.arrayBuffer,t.prototype.base64=function(){for(var t,r,e,i="",s=this.array(),h=0;h<15;)t=s[h++],r=s[h++],e=s[h++],i+=p[t>>>2]+p[63&(t<<4|r>>>4)]+p[63&(r<<2|e>>>6)]+p[63&e];return t=s[h],i+=p[t>>>2]+p[t<<4&63]+"=="};var _=v();f?module.exports=_:(i.md5=_,o&&define(function(){return _}))}();
	</script>


<script>

 var tpls = { en: 't.html', cn: 't.cn.html' }; function Lang(l){ if(l in tpls) return tpls[l]; return tpls['en']; } function selectLang(l){ var name = Lang(l); console.log(name); GET(name, "TPL", function(){ T('menu', 't_menu'); if(window.location.hash){ locationHashChanged(); }else{ GO('#/'); } }); } function loadTestTPL(cb){ GET("test.html", "testTPL", cb); } var s_lang = 'cn'; function locationHashChanged() { console.log("hashchanged-->" + location.hash); GO(window.location.hash); } document.addEventListener('DOMContentLoaded', function () { setHashs(); window.onpopstate = function(event) { console.log("popstate-->location: " + document.location + ", state: " + JSON.stringify(event.state)); }; window.onhashchange = locationHashChanged; selectLang(s_lang); wsinit(); }); 
	</script>
</body>
</html>
